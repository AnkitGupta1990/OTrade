<html>
<style>
td,th {
	font-size: 40px;
}
</style>
<body style="font-size:60px;">
<div id="btw" style="float:left"></div>
<div style="float:right"><button onclick="refresh()" style="font-size:60px;">Refresh</button></div>
<div style="clear:both"></div>
<div id="buystocks" style="float:left"></div>
<div style="float:right"><button onclick="clearStocks()" style="font-size:60px;">Clear</button></div>
<div style="clear:both"></div>
CE
<table border='1' style='border-collapse:collapse;' width="100%" cellpadding='2' id="ceList">
<thead><tr><th>SYMBOL</th><th>STRIKE</th><th>PRICE</th><th>OP/L</th><th>PCL</th><th style="display:none">Pur</th></tr></thead>
<tbody>
</tbody>
</table>
PE
<table border='1' style='border-collapse:collapse;' width="100%" cellpadding='2' id="peList">
<thead><tr><th>SYMBOL</th><th>STRIKE</th><th>PRICE</th><th>OP/L</th><th>PCL</th><th style="display:none">Pur</th></tr></thead>
<tbody>
</tbody>
</table>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.3/handlebars.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sheetrock/1.0.1/dist/sheetrock.min.js"></script>
<script> 
var stocks = ];
var today_stocks = ['PIDILITIND###PE###1200.0','KAJARIACER###PE###600.0','BHARATFIN###PE###960.0','AJANTPHARM###PE###1040.0','JUBLFOOD###PE###1320.0','KSCL###CE###450.0','EQUITAS###CE###130.0','TCS###CE###2140.0','UNIONBANK###CE###87.5','NBCC###CE###59.0'];
var ce_tbl_body = "";
var pe_tbl_body = "";
$.each(stocks, function(index,value) {
	var tbl_row = "";
	var clorstyle = '';
        $.each(today_stocks, function( index1, value1 ) {
		var valArr = value1.split("###");
		if(valArr[0] == value[0].replace("%26","&")) {
			var clor = "green";
			if(valArr[1] != value[1]) {
				clor = "red";
			}
			clorstyle = 'style=color:'+clor;
		}
	});
        tbl_row += "<td onclick='buy()' "+clorstyle+">"+value[0].replace("%26","&")+"</td>";
	tbl_row += "<td>"+value[2]+"</td>";
        var sname = value[0];
        sname = sname.replace("%26","_AND_");
	tbl_row += "<td id='"+value[1]+"_"+sname+"_current'>"+''+"</td>";
	tbl_row += "<td id='"+value[1]+"_"+sname+"_open'>"+''+"</td>";
	tbl_row += "<td id='"+value[1]+"_"+sname+"_pcl'>"+''+"</td>";
	tbl_row += "<td style='display:none' id='"+value[1]+"_"+sname+"_purchase_price'>"+''+"</td>";
	if(value[1] == 'CE') {
		ce_tbl_body += "<tr id='"+value[1]+"_"+sname+"'>"+tbl_row+"</tr>";
 	} else {
		pe_tbl_body += "<tr id='"+value[1]+"_"+sname+"'>"+tbl_row+"</tr>";
	}
	          
})
$("#ceList tbody").html(ce_tbl_body);
$("#peList tbody").html(pe_tbl_body);
$('#buystocks').html(localStorage.getItem('buy_stocks'));

function buy() {
var str = 'buy ' + $(event.target).parent().attr('id') + ' at ' + $(event.target).next().next().next().next().next().html();
localStorage.setItem('buy_stocks',localStorage.getItem('buy_stocks') == null ? '' : localStorage.getItem('buy_stocks') +' <br> ' + str);
$('#buystocks').html(localStorage.getItem('buy_stocks'));
}

function clearStocks() {
	localStorage.setItem('buy_stocks','');
	$('#buystocks').html(localStorage.getItem('buy_stocks'));
}

function refresh() {
$.each(stocks,function(index, value) {
	var query = "underlying="+value[0]+"&instrument=OPTSTK&expiry=30MAY2019&type="+value[1]+"&strike="+value[2];
	if($("#"+value[1]+"_"+value[0].replace("%26","_AND_")).length <= 0) {
		return true;	
	}
	$.ajax({
	  type: "GET",
	  dataType: "json",
	  url: "https://www.nseindia.com/live_market/dynaContent/live_watch/get_quote/ajaxFOGetQuoteJSON.jsp?"+query,
	  success: function(msg) {
	     var open = msg.data[0].openPrice;
             var low = msg.data[0].lowPrice;
	     var pcl = msg.data[0].prevClose;
	     var current = msg.data[0].lastPrice;
	     var sname = msg.data[0].underlying;
	     sname = sname.replace("&","_AND_");
	     var optionType = msg.data[0].optionType;
	     var purchase_price = msg.data[0].sellPrice1;
             $("#btw").html('Success : ' + current);
	     try {
		open = parseFloat(open);
		low = parseFloat(low);
		pcl = parseFloat(pcl);
		current = parseFloat(current);
		if(low >= open) {
			$("#"+optionType+"_"+sname+"_current").html(current);
			$("#"+optionType+"_"+sname+"_open").html(open);
			$("#"+optionType+"_"+sname+"_pcl").html(pcl);
			$("#"+optionType+"_"+sname+"_purchase_price").html(purchase_price);
		}else {
			$("#"+optionType+"_"+sname).remove();
		}
	     } catch (e) {
		$("#"+optionType+"_"+sname).remove();
	     }
	  },
	  error:function (xhr, ajaxOptions, thrownError){
	     $("#btw").html('Error : ' + xhr.status);
	  }
	});
});
}
refresh();
</script> 
